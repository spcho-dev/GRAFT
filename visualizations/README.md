# Project Data and Preprocessing

This document outlines the data sources and preprocessing pipeline required to reproduce the main experimental results and figures from our paper.

## Data Sources

The analyses in this project rely on publicly available data from the Comparative Toxicogenomics Database (CTD), the Network of Cancer Genes (NCG), gene set enrichment analysis performed using g:Profiler, and outputs generated by the model itself.

### 1. Comparative Toxicogenomics Database (CTD)

The raw data files were downloaded from the official CTD downloads page on June 5, 2025:
[https://ctdbase.org/downloads/](https://ctdbase.org/downloads/)

The following specific files were originally downloaded:

* **Disease Vocabulary:** `CTD_diseases.obo.gz`
    * **Source Section on CTD:** Disease vocabulary (MEDIC)
    * **Note:** This file was manually converted to `CTD_diseases.tsv` (provided in the `CTD_Association_data/` directory) before preprocessing.

* **Disease-Pathway Associations:** `CTD_diseases_pathways.tsv.gz`
    * **Source Section on CTD:** Disease–pathway associations
    * **Note:** The raw `.tsv.gz` file is provided in the `CTD_Association_data/` directory.

* **Phenotype-Disease Associations:** `CTD_Phenotype-Disease_biological_process_associations.tsv.gz`
    * **Source Section on CTD:** Phenotype (GO)–Disease Inference Networks
    * **Note:** Due to its large size, this raw file is not included in the repository.

To ensure reproducibility without requiring large downloads, all necessary preprocessed files derived from the sources above are already included in the `CTD_Association_data_preprocessed/` directory. The subsequent analysis scripts use these cleaned files directly.

### 2. Network of Cancer Genes (NCG)

* **Annotation File:** `NCG_cancerdrivers_annotation_supporting_evidence.tsv`
    * **Source:** Downloaded from the [Network of Cancer Genes (NCG)](http://network-cancer-genes.org/download.php) (version 7.2 or similar) on June 10, 2025.
    * **Usage:** Used to filter and identify potential cancer driver genes that are not already annotated in major databases. (Script: `filtering_ncg_potential_genes.py`)

### 3. Gene Lists (Used for Categorization and Filtering)

* `./Data/796true.txt`: List of known driver genes.
* `./Data/2187false.txt`: List of known non-driver genes.

### 4. Gene Set Enrichment Analysis (g:Profiler)

Enrichment analysis is performed on a list of predicted driver genes.

* **Input Gene List:**
    * `./node_prediction_pancancer/predicted_top_genes.txt`
    * Contains predicted driver genes (known drivers removed) used as the query for enrichment analysis.

* **Tool:**
    * Analysis conducted using the **g:Profiler** Python library (`gprofiler-official`).
    * **Sources queried:** Gene Ontology (GO:BP, GO:CC, GO:MF) and KEGG pathways.

### 5. Model Outputs (for Visualization)

* `./node_prediction_pancancer/node_embeddings.csv`: Contains node embeddings generated by the model for a specific fold (e.g., Fold 10), along with true labels and predicted probabilities. Used for UMAP and KDE plots.
* `./node_prediction_pancancer/attn_info.pt`: Contains model-generated attention weights for a single fold, along with test indices and true labels. Used for attention visualization scripts (`visualize_average_attention_weight.py`, `visualize_attention_clustermap.py`).
* `./node_prediction_pancancer/prediction_genes_STRING/` & `./node_prediction_pancancer/prediction_genes_CPDB/`: Directories containing prediction scores per gene for each fold (`predictions_fold_*.txt`). Used for the gene category plot.

***

## Preprocessing and Analysis Pipeline

The raw data is processed through a series of scripts to generate the final data used for visualization and analysis. The pipeline is organized into four main stages:

1.  **Enrichment Analysis Pipeline**
    * **CTD Data Cleaning:** (`enrichment_analysis_1_CTD_file_preprocessing.py`, `enrichment_analysis_2_CTD_GO_KEGG_preprocessing.py`)
        * These scripts process the raw TSV files from the `CTD_Association_data/` directory. They extract essential columns, create cleaned TSV files, and store the outputs in the `CTD_Association_data_preprocessed/` directory.
    * **Enrichment Analysis:** (`enrichment_analysis_3_gprofiler.py` - *assuming script name*)
        * Uses `predicted_top_genes.txt` as input for g:Profiler to perform enrichment analysis against GO and KEGG, saving the top 15 terms for each category into `.csv` files in `enrichment_analysis_results/`.
    * **Cancer Term Filtering:** (`enrichment_analysis_4_extract_cancer_related_term.py`)
        * Uses the cleaned CTD data and the enrichment `.csv` results to filter for cancer-relevant terms using MeSH hierarchy and keyword matching.
        * **Outputs:** `cancer_related_terms_with_diseaseids.csv` (structured data) and `cancer_related_terms_with_diseaseids.txt` (human-readable version).
    * **Enrichment Results Visualization:** (`enrichment_analysis_5_visualize_enrichment_analysis_result.py`)
        * Reads the `top_15_*.csv` enrichment results and the filtered cancer terms list to generate bar plots for each category, highlighting cancer-related terms.
        * **Output:** Saves plots as `.png` files in `enrichment_final_results/`.

2.  **Node Embedding Visualization**
    * **UMAP Visualization:** (`visualize_node_embedding.py`)
        * Takes the `node_embeddings.csv` file as input and generates a 2D UMAP scatter plot, coloring points by their true label (Driver/Non-driver).
        * **Output:** `figures/umap_visualization.jpg`.
    * **KDE Visualization:** (`visualize_node_embedding_all_pairwise_cosine_distance.py`)
        * Also uses the `node_embeddings.csv` file to calculate and plot the Kernel Density Estimate (KDE) of pairwise cosine distances between embeddings.
        * **Output:** `figures/kde_distance_plot.jpg`.

3.  **Gene Category Analysis and Visualization**
    * **Potential Driver Gene Filtering:** (`filtering_ncg_potential_genes.py`)
        * Takes the NCG annotation file and known gene lists to filter for potential novel driver candidates.
        * **Output:** `node_prediction_pancancer/potential_driver_genes_ncg7.2.txt`.
    * **Gene Category Prediction Score Visualization:** (`visualize_category_prediction_plot.py`)
        * Reads per-fold prediction scores and uses the gene lists to categorize genes. It then generates a bar plot comparing the average prediction score for each gene category.
        * **Output:** `figures/predicted_gene_category.jpg`.

4.  **Attention Mechanism Visualization**
    * **Average Attention Weight Visualization:** (`visualize_average_attention_weight.py`)
        * Takes the `attn_info.pt` file as input to calculate and plot the mean and standard deviation of attention weights for each network type (PPI, Pathway, GO).
        * **Output:** A bar plot (`figures/avg_attention_weight.jpg`).
    * **Attention Weight Clustermap Visualization:** (`visualize_attention_clustermap.py`)
        * Also uses the `attn_info.pt` file to generate a clustered heatmap of standardized attention weights, with rows colored by the gene's true label.
        * **Output:** A clustermap image (`figures/clustermap_attention.jpg`).
