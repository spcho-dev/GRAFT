# Project Data and Preprocessing

This document outlines the data sources and the preprocessing pipeline used in this project to generate the final datasets required for analysis and visualization.

## Data Sources

The analyses in this project rely on publicly available data from the Comparative Toxicogenomics Database (CTD) and gene set enrichment analysis performed using g:Profiler.

### 1. Comparative Toxicogenomics Database (CTD)

The raw data files were downloaded from the official CTD downloads page:
[https://ctdbase.org/downloads/](https://ctdbase.org/downloads/)

The following specific files are used in our preprocessing pipeline:

* **Disease Vocabulary:** `CTD_diseases.obo.gz`
    * **Source Section on CTD:** Disease vocabulary (MEDIC)
    * **Usage:** This file is parsed to extract and build a clean vocabulary of diseases, including their names, official IDs, parent IDs (for hierarchy), and synonyms. (Script: `obo_to_tsv_converter.py`, resulting in `CTD_diseases.tsv`)

* **Disease-Pathway Associations:** `CTD_diseases_pathways.tsv.gz`
    * **Source Section on CTD:** Disease–pathway associations
    * **Usage:** Used to process associations between diseases, KEGG pathways, and the involved genes.

* **Phenotype-Disease Associations:** `CTD_Phenotype-Disease_biological_process_associations.tsv.gz`
    * **Source Section on CTD:** Phenotype (GO)–Disease Inference Networks
    * **Usage:** Used to process associations between diseases, Gene Ontology (GO) biological processes, and the involved genes.

### 2. Gene Set Enrichment Analysis (g:Profiler)

Enrichment analysis is performed on a list of predicted driver genes.

* **Input Gene List:**
    * `./node_prediction_pancancer/predicted_top_genes.txt`
    * This file contains a list of predicted driver genes (with known drivers removed) that serves as the query for the enrichment analysis.

* **Tool:**
    * The analysis is conducted using the **g:Profiler** tool via its Python library (`gprofiler-official`).
    * **Sources queried:** Gene Ontology (GO:BP, GO:CC, GO:MF) and KEGG pathways.

## Preprocessing and Analysis Pipeline

The raw data is processed through a series of scripts to generate the final data used for visualization and analysis.

1.  **CTD Data Cleaning:** (`process_ctd_diseases.py`, `preprocess_ctd_associations.py`)
    * The raw `.obo` and `.tsv` files from CTD are first processed to extract only the essential columns and create cleaned, standardized TSV files. This step ensures the data is in a consistent format for subsequent analyses. The resulting files are stored in the `CTD_Association_data_preprocessed/` directory.

2.  **Enrichment Analysis:** (`enrichment_analysis.py` - assuming this is the script name)
    * The `predicted_top_genes.txt` list is used as input for g:Profiler.
    * The script performs an enrichment analysis against GO and KEGG databases and saves the top 15 enriched terms for each category (BP, CC, MF, KEGG) into separate `.csv` files within the `enrichment_analysis_results/` directory (e.g., `top_15_GO_BP.csv`).

3.  **Cancer Term Filtering:** (`filter_cancer_terms.py`)
    * This script takes the cleaned CTD data and the enrichment results as input.
    * It filters the enrichment terms to identify those relevant to cancer using two methods:
        * **MeSH Hierarchy:** Checks if a term is associated with any cancer-related MeSH Disease ID derived from the CTD disease hierarchy (based on `MESH:D009369`).
        * **Keyword Matching:** Checks if the term name contains specific cancer-related keywords (e.g., 'cancer', 'tumor').
    * **Outputs:**
        * `cancer_related_terms_with_diseaseids.csv`: A structured CSV file listing the identified cancer terms, the source of relevance (MeSH/Keyword), and associated MeSH Disease IDs.
        * `cancer_related_terms_with_diseaseids.txt`: A human-readable text file version of the filtered cancer terms.

4.  **Enrichment Results Visualization:** (`generate_enrichment_plots.py`)
    * This script reads the individual enrichment result `.csv` files (e.g., `top_15_GO_BP.csv`) generated by the g:Profiler analysis.
    * It also uses the `cancer_related_terms_with_diseaseids.txt` file generated in the previous step.
    * **Function:** It generates horizontal bar plots for each enrichment category (GO:BP, GO:CC, GO:MF, KEGG), visualizing the top 15 terms based on their adjusted p-values (-log10 scale).
    * **Highlighting:** Terms identified as cancer-related in the `cancer_related_terms_with_diseaseids.txt` file are highlighted (e.g., using bold font) in the plots.
    * **Output:** Saves the plots as `.png` files (e.g., `GO_BP.png`) in the `enrichment_final_results/` directory.
