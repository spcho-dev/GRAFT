# Project Data and Preprocessing

This document outlines the data sources and the preprocessing pipeline used in this project to generate the final datasets required for analysis and visualization.

## Data Sources

The analyses in this project rely on publicly available data from the Comparative Toxicogenomics Database (CTD), the Network of Cancer Genes (NCG), gene set enrichment analysis performed using g:Profiler, and node embeddings generated by the model.

### 1. Comparative Toxicogenomics Database (CTD)

The raw data files were downloaded from the official CTD downloads page:
[https://ctdbase.org/downloads/](https://ctdbase.org/downloads/)

The following specific files are used in our preprocessing pipeline:

* **Disease Vocabulary:** `CTD_diseases.obo.gz`
    * **Source Section on CTD:** Disease vocabulary (MEDIC)
    * **Usage:** Parsed to build a clean vocabulary of diseases (IDs, names, parents, synonyms). (Script: `obo_to_tsv_converter.py`, resulting in `CTD_diseases.tsv`)

* **Disease-Pathway Associations:** `CTD_diseases_pathways.tsv.gz`
    * **Source Section on CTD:** Disease–pathway associations
    * **Usage:** Processes associations between diseases, KEGG pathways, and genes.

* **Phenotype-Disease Associations:** `CTD_Phenotype-Disease_biological_process_associations.tsv.gz`
    * **Source Section on CTD:** Phenotype (GO)–Disease Inference Networks
    * **Usage:** Processes associations between diseases, Gene Ontology (GO) biological processes, and genes.

### 2. Network of Cancer Genes (NCG)

* **Annotation File:** `NCG_cancerdrivers_annotation_supporting_evidence.tsv`
    * **Source:** Downloaded from NCG (version 7.2 or similar).
    * **Usage:** Used to filter and identify potential cancer driver genes that are not already annotated in major databases. (Script: `filtering_ncg_potential_genes.py`)

### 3. Gene Lists (Used for Categorization and Filtering)

* `./Data/796true.txt`: List of known driver genes.
* `./Data/2187false.txt`: List of known non-driver genes.

### 4. Gene Set Enrichment Analysis (g:Profiler)

Enrichment analysis is performed on a list of predicted driver genes.

* **Input Gene List:**
    * `./node_prediction_pancancer/predicted_top_genes.txt`
    * Contains predicted driver genes (known drivers removed) used as the query for enrichment analysis.

* **Tool:**
    * Analysis conducted using the **g:Profiler** Python library (`gprofiler-official`).
    * **Sources queried:** Gene Ontology (GO:BP, GO:CC, GO:MF) and KEGG pathways.

### 5. Model Outputs (for Visualization)

* `./node_prediction_pancancer/node_embeddings.csv`: Contains node embeddings generated by the model for a specific fold (e.g., Fold 10), along with true labels and predicted probabilities. Used for UMAP and KDE plots.
* `./node_prediction_pancancer/prediction_genes_STRING/` & `./node_prediction_pancancer/prediction_genes_CPDB/`: Directories containing prediction scores per gene for each fold (`predictions_fold_*.txt`). Used for the gene category plot.

## Preprocessing and Analysis Pipeline

The raw data is processed through a series of scripts to generate the final data used for visualization and analysis.

1.  **CTD Data Cleaning:** (`obo_to_tsv_converter.py`, `process_ctd_diseases.py`, `preprocess_ctd_associations.py`)
    * The raw `.obo` and `.tsv` files from CTD are processed to extract essential columns and create cleaned, standardized TSV files (e.g., `CTD_diseases_cleaned.tsv`). These are stored in `CTD_Association_data_preprocessed/`.

2.  **Potential Driver Gene Filtering:** (`filtering_ncg_potential_genes.py`)
    * Takes the NCG annotation file (`NCG_...evidence.tsv`), known driver (`796true.txt`), and non-driver (`2187false.txt`) lists as input.
    * Filters the NCG list to identify genes not present in major cancer gene databases *and* not already labeled as known drivers or non-drivers.
    * **Output:** `node_prediction_pancancer/potential_driver_genes_ncg7.2.txt` - A list of potential novel driver candidates.

3.  **Enrichment Analysis:** (`enrichment_analysis.py` - *assuming script name*)
    * Uses `predicted_top_genes.txt` as input for g:Profiler.
    * Performs enrichment analysis against GO and KEGG, saving the top 15 terms for each category (BP, CC, MF, KEGG) into `.csv` files in `enrichment_analysis_results/` (e.g., `top_15_GO_BP.csv`).

4.  **Cancer Term Filtering:** (`filter_cancer_terms.py`)
    * Uses the cleaned CTD data and the enrichment `.csv` results.
    * Filters enrichment terms for cancer relevance using MeSH hierarchy and keyword matching.
    * **Outputs:**
        * `cancer_related_terms_with_diseaseids.csv`: Structured list of cancer-relevant terms.
        * `cancer_related_terms_with_diseaseids.txt`: Human-readable version.

5.  **Enrichment Results Visualization:** (`generate_enrichment_plots.py`)
    * Reads the `top_15_*.csv` enrichment results and the `cancer_related_terms_with_diseaseids.txt` file.
    * Generates bar plots for each category, highlighting cancer-related terms.
    * **Output:** Saves plots as `.png` files (e.g., `GO_BP.png`) in `enrichment_final_results/`.

6.  **Node Embedding Visualization (UMAP):** (`visualize_node_embedding.py`)
    * Takes the `node_embeddings.csv` file (containing embeddings for a single fold) as input.
    * Applies UMAP dimensionality reduction to the standardized embeddings.
    * Generates a 2D scatter plot, coloring points based on their true label (Driver/Non-driver).
    * **Output:** Saves the plot as `figures/umap_visualization.jpg`.

7.  **Node Embedding Visualization (KDE):** (`visualize_node_embedding_all_pairwise_cosine_distance.py`)
    * Also uses the `node_embeddings.csv` file.
    * Calculates pairwise cosine distances between embeddings within and between Driver/Non-driver groups.
    * Generates Kernel Density Estimate (KDE) plots to visualize the distribution of these distances.
    * **Output:** Saves the plot as `figures/kde_distance_plot.jpg`.

8.  **Gene Category Prediction Score Visualization:** (`visualize_category_prediction_plot.py`)
    * Reads the per-fold prediction scores from `node_prediction_pancancer/prediction_genes_*/`.
    * Uses the `796true.txt`, `2187false.txt`, and `potential_driver_genes_ncg7.2.txt` lists to categorize genes.
    * Calculates the average prediction score for each gene category (Known Driver, Potential Driver, Non-driver, Other) across all folds for both STRING and CPDB networks.
    * Generates a bar plot comparing these average scores.
    * **Output:** Saves the plot as `figures/predicted_gene_category.jpg`.
